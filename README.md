* [Задание](#Задание)
* [Установка](#Установка)
* [Затраченое время](#Затраченое-время)
* [Претензии к заданию](#Претензии-к-заданию)

Задание
---------

Задача: Реализация авторизации и регистрации в приложении  (Реализации API серверного приложения)
Описание задачи: Вашей задачей является разработка серверной части приложения, которая позволит пользователям авторизовываться и регистрироваться в нем.
Создать проект на языке программирования PHP 7.4 (Возможно использование фреймворка – Codeigniter4, Yii, Laravel, Symphony)
Реализовать механизм регистрации, который позволит пользователям зарегистрироваться в вашем приложении
Реализовать механизм авторизации, который будет проверять подлинность пользователей


Требования к задаче:
- Используйте механизм хранения данных пользователей в базе данных (используйте СУБД MYSQL)
- Обеспечьте безопасность передачи и хранения пользовательских данных
- Документируйте ваш код и создайте простую инструкцию по развертыванию и запуску вашего сервера
- Разместите решение задачи на GitHub
- Имя запроса авторизации и регистрации: user_auth
- Метод запроса: GET
- Входящие данные: access_token, id, first_name, last_name, country, city, sig
- Таблица для хранения данных: users, поля id (int) – идентификатор пользователя, first_name (string) – Имя пользователя, last_name (string) – фамилия, city (string) – Город, country (string) – Страна. Таблица для хранения сессий – users_sessions (user_id (int) – идентификатор пользователя, access_token (string))
- Формат ответа: JSON. В Ответе вернуть данные: id, first_name, last_name, city, country, access_token в случаи успешной авторизации/регистрации, в противном случаи ошибку.
Примечание: access_token носит в задаче формальный характер и будет использоваться в последующих запросах, не указанных в данном задании.

Данные для теста:
- Секретный ключ приложения: 977fea8deca4c2c2330544cf2e388284 – Необходимо задать на сервере (например, в «конфиге»)
- Входящие данные: access_token=07b38cd0e778340eb40b25e005476ce8, id=1, first_name=Иван, last_name=Иванов, city=Москва, country=Россия, sig=5427b31460cd807aab7e184364960958

Алгоритм проверки подписи:
- Сортировка входящих параметров по ключу (используйте ksort)
- Сформируйте строку $str из полученных параметров исключив из нее sig
- К концу полученной строки добавьте секретный ключ
- С полученной строкой выполните mb_strtolower( md5($str), 'UTF-8' ) и сравните результат с пришедшем sig
- Если mb_strtolower( md5($str), 'UTF-8' ) === sig, зарегистрируйте пользователя, в противном случаи выдайте ошибку
Пример полученной строки относительно входящих параметров: access_token=07b38cd0e778340eb40b25e005476ce8city=Москваcountry=Россияfirst_name=Иванid=1last_name=Иванов977fea8deca4c2c2330544cf2e388284
mb_strtolower( md5(‘access_token=07b38cd0e778340eb40b25e005476ce8, id=1, first_name=Иван, last_name=Иванов, city=Москва, country=Россия, sig=5427b31460cd807aab7e184364960958’), 'UTF-8' ) === 5427b31460cd807aab7e184364960958
Если подпись верна, проверьте наличие пользователя в таблице users по id. Если нет пользователя, то добавьте его в таблицу users. Если пользователь уже существует, сделайте update присланных полей: first_name, last_name, city и country. Также примените запрос replace к таблице users_sessions ( user_id (уникальный ключ) = id, access_token )


Пример успешного ответа:

{
"access_token": "07b38cd0e778340eb40b25e005476ce8",
"user_info": {
"id": 1,
"first_name": "Иван",
"last_name": "Иванов",
"city": "Москва",
"country": "Россия",
},
"error": "",
"error_key": "",
}


Входящие данные: access_token=07b38cd0e778340eb40b25e005476ce8, id=1, first_name=Иван, last_name=Иванов, city=Москва, country=Россия, sig=4427b31460cd807aab7e184364960958


Пример неуспешного ответа:


{
"error": "Ошибка авторизации в приложении",
"error_key": "signature error",
}

Установка
---------
Для разварачивания проекта у вас должы быть установлены [Docker](http://docker.com) и Docker compose.

1. В консоли выполните команду для клонирования репозитория с проектом.
```
git clone git@github.com:anastasiia-lialina/auth.git <название директории>
```
   
2. Копируйте файл .env.example и назывите копию .env. В .env измените настроки подключения к БД и секретный ключ.

3. В консоли запустите
```
make init
```

Теперь метод будет доступен по адресу 
http://127.0.0.1:8000/user_auth

Затраченое время
-----
10 часов (api, docker, make файлы)/

Предложения к заданию
---
- Почему все действия в одном? Почему бы не разделить их на GET, POST и тд?
- Описать опязательные поля и коды ошибок.
- "Пример полученной строки относительно входящих параметров:" sig не верный

